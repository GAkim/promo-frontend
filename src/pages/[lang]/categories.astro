---
import Layout from "../../layouts/Layout.astro";
import { getCategories } from "../../lib/strapi";
import { getStrapiMediaUrl } from "../../lib/strapi";
import type { Category } from "../../types/strapi";
import type { GetStaticPathsResult } from "astro";

export const prerender = true;

export interface Props {
  lang: string;
  categories: Category[];
}

const { lang, categories } = Astro.props;

export async function getStaticPaths(): Promise<GetStaticPathsResult> {
  const locales = ["lv", "en", "ru"] as const;
  const paths: GetStaticPathsResult = [];

  for (const locale of locales) {
    const categories = await getCategories(locale);
    paths.push({
      params: { lang: locale },
      props: { lang: locale, categories },
    });
  }

  return paths;
}

const titles: Record<string, string> = {
  lv: "Kategorijas",
  en: "Categories",
  ru: "Категории",
};

const noCategoriesLabels: Record<string, string> = {
  lv: "Pašlaik nav kategoriju",
  en: "No categories available",
  ru: "Категорий пока нет",
};

// Generate hreflang alternates for listing page
const hreflangAlternates = ['lv', 'en', 'ru'].map((locale) => ({
  hreflang: locale,
  href: `https://promocode.lv/${locale}/categories/`,
}));
hreflangAlternates.push({
  hreflang: 'x-default',
  href: 'https://promocode.lv/lv/categories/',
});
---

<Layout title={titles[lang]} lang={lang} hreflangAlternates={hreflangAlternates}>
  <div class="py-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-8">{titles[lang]}</h1>

    {
      categories.length === 0 ? (
        <div class="text-center text-gray-500 py-12">
          <p class="text-lg">{noCategoriesLabels[lang]}</p>
        </div>
      ) : (
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          {categories.map((category) => (
            <a
              href={`/${lang}/categories/${category.slug}`}
              class="bg-white rounded-lg shadow-sm border overflow-hidden hover:shadow-md transition-shadow block"
            >
              <div class="p-6">
                <div class="flex items-center gap-4 mb-4">
                  {category.logo ? (
                    <img
                      src={getStrapiMediaUrl(category.logo)}
                      alt={category.name}
                      class="w-16 h-16 object-contain"
                    />
                  ) : (
                    <div class="w-16 h-16 bg-gray-100 rounded flex items-center justify-center">
                      <span class="text-gray-400 text-xl">
                        {category.name?.[0]}
                      </span>
                    </div>
                  )}
                  <h3 class="text-xl font-semibold text-gray-900">
                    {category.name}
                  </h3>
                </div>
                {category.description && (
                  <p class="text-gray-600">{category.description}</p>
                )}
              </div>
            </a>
          ))}
        </div>
      )
    }
  </div>
</Layout>
