---
import Layout from "../layouts/Layout.astro";
import PromoCodeCard from "../components/PromoCodeCard.astro";
import { getPromoCodes } from "../lib/strapi";
import { markdownToHtml } from "../lib/markdown";
import type { PromoCode } from "../types/strapi";

// Root page serves Latvian (default locale) content
const lang = "lv";

// Fetch featured promo codes for Latvian
const promoCodes = await getPromoCodes(lang, {
  featured: true,
  active: true,
  limit: 6,
});

// Page content in Latvian
const page = {
  title: "S훮kums",
  heading: "Akciju kodi un atlaides",
  description:
    "PromoCode.lv is a Latvian platform for promo codes and discounts, dedicated to helping people save money.",
  cta: "Skat카t visus kodus",
};

// Generate hreflang alternates for homepage
const hreflangAlternates = [
  { hreflang: "lv", href: "https://promocode.lv/lv/" },
  { hreflang: "en", href: "https://promocode.lv/en/" },
  { hreflang: "ru", href: "https://promocode.lv/ru/" },
  { hreflang: "x-default", href: "https://promocode.lv/lv/" },
];

// Pre-render markdown descriptions
const promoCodesWithHtml = await Promise.all(
  promoCodes.map(async (promo) => ({
    ...promo,
    htmlDescription: promo.description
      ? await markdownToHtml(promo.description)
      : null,
  })),
);
---

<Layout
  title={page.title}
  description={page.description}
  lang={lang}
  hreflangAlternates={hreflangAlternates}
>
  <div class="text-center py-12">
    <h1 class="text-4xl font-bold text-gray-900 mb-4">{page.heading}</h1>
    <p class="text-xl text-gray-600 mb-8">{page.description}</p>
    <a
      href={`/${lang}/promo-codes`}
      class="inline-block bg-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors"
    >
      {page.cta}
    </a>
  </div>

  <!-- Featured Promo Codes Section -->
  <section class="mt-16">
    <h2 class="text-2xl font-bold text-gray-900 mb-6">Izceltie akciju kodi</h2>

    {
      promoCodes.length === 0 ? (
        <div class="text-center text-gray-500 py-8">
          Dr카z b큰s pieejami izceltie akciju kodi
        </div>
      ) : (
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          {promoCodesWithHtml.map((promo) => (
            <PromoCodeCard
              promo={promo}
              lang={lang}
              htmlDescription={promo.htmlDescription}
            />
          ))}
        </div>
      )
    }
  </section>
</Layout>
